{
  "name": "bayleaf-api",
  "main": "src/index.ts",
  "compatibility_date": "2025-01-31",
  "compatibility_flags": ["nodejs_compat"],
  
  // Observability - DISABLE THIS after deployment is working
  // to avoid accidental data accumulation
  "observability": {
    "enabled": true,
    "head_sampling_rate": 1
  },

  "routes": [
    { "pattern": "api.bayleaf.chat", "custom_domain": true }
  ],

  // D1 database for proxy key mappings
  // Create with: wrangler d1 create bayleaf-keys
  // Then run migration: wrangler d1 migrations apply bayleaf-keys
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "bayleaf-keys",
      "database_id": "e249d6a6-41cf-4ab7-93d6-b677ac95b524"
    }
  ],

  // Environment variables (set via wrangler secret or dashboard)
  // These are placeholders - actual values should be set as secrets
  "vars": {
    "SPENDING_LIMIT_DOLLARS": "1.0",
    "SPENDING_LIMIT_RESET": "daily",
    "KEY_NAME_TEMPLATE": "BayLeaf API for $email",
    "ALLOWED_EMAIL_DOMAIN": "ucsc.edu",
    "SYSTEM_PROMPT_PREFIX": "You are accessing the BayLeaf API (https://api.bayleaf.chat/),  UC Santa Cruz's locally-operated AI service. Help users develop capability they can carry forwardâ€”into their own work and into collaboration with others. Make reasoning visible. Teach what generalizes. Conversations are private and never used for training.",
    
    // Campus Pass: allow on-campus users to access without personal API keys
    "RECOMMENDED_MODEL": "z-ai/glm-5",
    
    // Campus Pass: allow on-campus users to access without personal API keys
    // Set CAMPUS_IP_RANGES to enable (empty string = disabled)
    "CAMPUS_IP_RANGES": "128.114.0.0/16,169.233.0.0/16,192.35.220.0/24,192.35.223.0/24,2607:F5F0::/32,127.0.0.1/32,::1/128",
    "CAMPUS_SYSTEM_PREFIX": "Note: This user is accessing the API via shared on-campus access. They can provision a personal API key at no cost by visiting https://api.bayleaf.chat/"
  }

  // Secrets to configure via `wrangler secret put`:
  // - OPENROUTER_PROVISIONING_KEY
  // - OIDC_CLIENT_ID  
  // - OIDC_CLIENT_SECRET
  // - CAMPUS_POOL_KEY (for Campus Pass feature)
}
